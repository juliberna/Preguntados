{{> navbar}}
<main class="fondo">
  <div class="perfil-grid">
    <div class="card perfil-card">
      <div class="perfil-top">
        <img src="/public/uploads/{{foto_perfil_url}}" alt="perfil" class="perfil-img">
        <div class="nombre">{{nombre_usuario}}</div>
      </div>
      <div class="info">Nivel 7<br>Ranking #125</div>
    </div>

    <div class="card partidas-card">
      <p class="fs-4 text-white">Partidas:</p>
      <span class="mb-2 fs-5"><strong>54 Jugadas</strong></span>
      <span class="ganadas mb-2 fs-5">29 Ganadas</span>
      <span class="perdidas mb-2 fs-5">25 Perdidas</span>
    </div>

    <div class="card categorias-card">
      <p class="fs-4 text-white">Categorías destacadas:</p><br>
      <div class="categoria-botones">
        <span class="categoria-btn historia">Historia</span>
        <span class="categoria-btn entretenimiento">Entretenimiento</span>
        <span class="categoria-btn ciencia">Ciencia</span>
      </div>
    </div>

    <div class="card qr-card justify-content-center align-items-center">
      <img class="qr" src="/public/images/ImagenQR.png" alt="QR">
    </div>

    <div class="card mapa-card">
      <p class="fs-4 text-white">Ubicación: <span id="ubicacion-texto"></span></p>
      <div id="map" style="height: 200px"></div>
    </div>
  </div>
</main>

<script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
<script>
  const ciudad = "{{nombre_ciudad}}";
  const pais = "{{nombre_pais}}";
  const ubicacion = `${ciudad}, ${pais}`;

  document.getElementById("ubicacion-texto").textContent = ubicacion;

  // Buscar coordenadas con Nominatim
  fetch(`https://nominatim.openstreetmap.org/search?q=${encodeURIComponent(ubicacion)}&format=json&limit=1`, {
    headers: {
      'User-Agent': 'Preguntopolis/1.0 (nicolasbon019@gmail.com)'
    }
  })
    .then(res => res.json())
    .then(data => {
      if (data.length > 0) {
        const lat = parseFloat(data[0].lat);
        const lon = parseFloat(data[0].lon);

        const map = L.map('map').setView([lat, lon], 10);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
          attribution: '© OpenStreetMap contributors'
        }).addTo(map);

        L.marker([lat, lon]).addTo(map)
          .bindPopup(ubicacion)
          .openPopup();
      } else {
        document.getElementById("map").innerHTML = "No se pudo encontrar la ubicación.";
      }
    })
    .catch(err => {
      console.error("Error al buscar ubicación:", err);
    });
</script>